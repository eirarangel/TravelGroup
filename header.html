<?php
if (isset($_GET['lang'])) {
?>
<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Basic -->
        <meta charset="utf-8">
        <title>Travelgroup Holidays</title>
        <meta name="keywords" content="HTML5 Template" />
        <meta name="description" content="Travel Group Agency for College Holidays">
        <meta name="author" content="iwthemes.com">  

        <!-- Mobile Metas -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Theme CSS -->
        <link href="css/style.css" rel="stylesheet" media="screen">
        <!-- Responsive CSS -->
        <link href="css/theme-responsive.css" rel="stylesheet" media="screen">
        <!-- Skins Theme -->
        <link href="#" rel="stylesheet" media="screen" class="skin">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
        <!-- Favicons -->
        <link rel="shortcut icon" href="img/icons/favicon.ico">
        <link rel="apple-touch-icon" href="img/icons/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="img/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="img/icons/apple-touch-icon-114x114.png">  

        <!-- Head Libs -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>
        <script src="js/modernizr.js"></script>
        <script>Parse.initialize("3XWv4k4eZzbX63GE3OXlOR5rHVTruOxnXcpF3xcz", "E6EpUdMT23lzPE8rJ4gEmcMYnFyCOIWQZwDiCzc9");</script>
        

        <!--[if IE]>
            <link rel="stylesheet" href="css/ie/ie.css">
        <![endif]-->

        <!--[if lte IE 8]>
            <script src="js/responsive/html5shiv.js"></script>
            <script src="js/responsive/respond.js"></script>
        <![endif]-->
    </head>
    <body>
       <!--Preloader-->
        <div class="preloader"><div class="status">&nbsp;</div></div>
        <!--End Preloader-->    

        <!-- layout-->
        <div id="layout">
            <!-- Header-->
            <!-- Main Nav -->
            <div id="header-sticky-wrapper" class="sticky-wrapper" style="height: 60px;">
                <header id="header" class="header-v3">
                    <!-- Main Nav -->
                    <nav class="flat-mega-menu">            
                        <!-- flat-mega-menu class -->
                        <label for="mobile-button"> <i class="fa fa-bars"></i></label><!-- mobile click button to show menu -->
                        <input id="mobile-button" type="checkbox">                          

                        <ul class="collapse"><!-- collapse class for collapse the drop down -->
                            <!-- website title - Logo class -->
                            <li class="title">
                                <a href="index.php?lang=esp"><span>T</span>ravelgroup<span>.</span></a> 
                                <!--<i class="fa fa-rocket"></i>-->
                            </li>
                            <!-- End website title - Logo class -->

                            <li class="menu-element" id="menu-main_content"><a href="index.php?lang=esp">INICIO</a></li>

                            <li class="menu-element" id="menu-trips"><a href="trips.php?lang=esp">VIAJES</a></li>                        
                            
                            <li><a href="#">PAQUETES</a> 
                                <div id="top-menu-packages" class="drop-down full-width hover-fade">
                                </div>
                            </li>                        
                            <?php 
                                $url = substr($_SERVER['REQUEST_URI'], 0, -9);
                            ?>
                            <li class="menu-element" id="menu-contact"><a href="contact.php?lang=esp">CONTACTO</a></li>
                            <li><a href="<?= $url ?>" style="display: inline-block;">Lenguaje <img src="img/mx.png" style="display: inline-block;"></a></li>
                        </ul>
                    </nav>
                    <!-- Main Nav -->
                </header>
            </div>
            <!-- Main Nav -->
            <!-- End Header-->
<?php 
}
else{
?>
<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Basic -->
        <meta charset="utf-8">
        <title>Travelgroup Holidays</title>
        <meta name="keywords" content="HTML5 Template" />
        <meta name="description" content="Travel Group Agency for College Holidays">
        <meta name="author" content="iwthemes.com">  

        <!-- Mobile Metas -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Theme CSS -->
        <link href="css/style.css" rel="stylesheet" media="screen">
        <!-- Responsive CSS -->
        <link href="css/theme-responsive.css" rel="stylesheet" media="screen">
        <!-- Skins Theme -->
        <link href="#" rel="stylesheet" media="screen" class="skin">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
        <!-- Favicons -->
        <link rel="shortcut icon" href="img/icons/favicon.ico">
        <link rel="apple-touch-icon" href="img/icons/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="img/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="img/icons/apple-touch-icon-114x114.png">  

        <!-- Head Libs -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>
        <script src="js/modernizr.js"></script>
        <script>Parse.initialize("3XWv4k4eZzbX63GE3OXlOR5rHVTruOxnXcpF3xcz", "E6EpUdMT23lzPE8rJ4gEmcMYnFyCOIWQZwDiCzc9");</script>
        

        <!--[if IE]>
            <link rel="stylesheet" href="css/ie/ie.css">
        <![endif]-->

        <!--[if lte IE 8]>
            <script src="js/responsive/html5shiv.js"></script>
            <script src="js/responsive/respond.js"></script>
        <![endif]-->
    </head>
    <body>
       <!--Preloader-->
        <div class="preloader"><div class="status">&nbsp;</div></div>
        <!--End Preloader-->    

        <!-- layout-->
        <div id="layout">
            <!-- Header-->
            <!-- Main Nav -->
            <div id="header-sticky-wrapper" class="sticky-wrapper" style="height: 60px;">
                <header id="header" class="header-v3">
                    <!-- Main Nav -->
                    <nav class="flat-mega-menu">            
                        <!-- flat-mega-menu class -->
                        <label for="mobile-button"> <i class="fa fa-bars"></i></label><!-- mobile click button to show menu -->
                        <input id="mobile-button" type="checkbox">                          

                        <ul class="collapse"><!-- collapse class for collapse the drop down -->
                            <!-- website title - Logo class -->
                            <li class="title">
                                <a href="index.php"><span>T</span>ravelgroup<span>.</span></a> 
                                <!--<i class="fa fa-rocket"></i>-->
                            </li>
                            <!-- End website title - Logo class -->

                            <li class="menu-element" id="menu-main_content"><a href="index.php">HOME</a></li>

                            <li class="menu-element" id="menu-trips"><a href="trips.php">TRIPS</a></li>                        
                            
                            <li><a href="#">PACKAGES</a> 
                                <div id="top-menu-packages" class="drop-down full-width hover-fade">
                                </div>
                            </li>                        
                            <?php
                                $urlLang = "?lang=esp";
                                if (isset($_GET['view'])) {
                                    $urlLang = "&lang=esp";
                                }
                            ?>
                            <li class="menu-element" id="menu-contact"><a href="contact.php">CONTACT</a></li>
                            <li><a href="<?= $_SERVER['REQUEST_URI'] . $urlLang; ?>" style="display: inline-block;">Language <img src="img/usa.png" style="display: inline-block;"></a></li>
                        </ul>
                    </nav>
                    <!-- Main Nav -->
                </header>
            </div>
            <!-- Main Nav -->
            <!-- End Header-->

<?php 
}
?>

            <script type="text/javascript">
            var lang = "eng";
            $(function() {
                if(getURLParameter("lang")) {
                    lang = getURLParameter("lang");
                }
                setMenuPackages();
                
            });
            function setMenuPackages() {
                    var query = new Parse.Query(Parse.Object.extend("Packages"));
                    query.equalTo("priority", 1);
                    if(lang != "eng")
                        query.equalTo("languages", 0);
                    else 
                        query.equalTo("languages", 1);
                    query.limit(4);
                    query.find({
                        success: function(results) {
                            createMenuPackagesTemplate(results);
                        }, error: function(error) {
                            console.log("Error: " + error.code + " " + error.message);
                        }
                    });
                }

                function createMenuPackagesTemplate(results) {
                    var elements = "";
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];

                        var description = "Ask your travel agent";
                        var urlLang = "";
                        if(lang == "esp") {
                            description = "Pregunta a tu agente de ventas";
                            urlLang = "&lang=esp";
                        }
                        if(typeof object.get("description") != "undefined") {
                            description = object.get("description").substring(0,100) + "...";
                        }
                        var image = "img/gallery-2/1.jpg";
                        if(typeof object.get("image") != "undefined") {
                            image = object.get("image").url();
                        }

                        var button_text = "View details";
                        if(lang != "eng") button_text = "Ver detalles";
                        var element = '<ul id="package' + object.id + '">' + 
                                        '<li class="menu-element" id="menu-packages">' +
                                            '<h2><span>' + object.get('name') + '</span></h2>' +
                                            '<a href="packages.php?view=package' + object.id + '"><img class="img" src="'+image+'" alt="image 1"> </a>' +
                                            '<p>' + description + '</p>' +
                                            '<a href="packages.php?view=package' + object.id + urlLang + '" class="btn btn-primary">' + button_text + '</a>' +
                                        '</li>' +
                                    '</ul>';
                        elements += element;      
                    }
                    $("#top-menu-packages").empty();
                    $("#top-menu-packages").append(elements);
                }

                function getURLParameter(name) {
                  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
                }
            </script>
